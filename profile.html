<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - ManualShop</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container">
                <a href="index.html" class="logo">ManualShop</a>
                <ul class="nav-links">
                    <li><a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                    <li><a href="about.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                </ul>
                <div class="header-controls">
                    <div class="auth-button" id="authButton">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="profile-section">
            <div class="container">
                <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
                <div class="profile-container">
                    <div class="profile-card">
                        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è</h2>
                        <div class="profile-info">
                            <div class="info-item">
                                <label>Email:</label>
                                <p id="userEmail"></p>
                            </div>
                            <div class="info-item">
                                <label>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</label>
                                <p id="registrationDate"></p>
                            </div>
                            <div class="info-item">
                                <label>–ö—É–ø–ª–µ–Ω–Ω—ã–µ –º–∞–Ω—É–∞–ª—ã:</label>
                                <p id="purchaseCount">0</p>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="logout()">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
                    </div>

                    <div class="profile-card">
                        <h2>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</h2>
                        <div id="purchaseHistory" class="purchase-history">
                            <p class="empty-message">–£ –≤–∞—Å –Ω–µ—Ç –ø–æ–∫—É–ø–æ–∫</p>
                        </div>
                    </div>

                    <div class="profile-card">
                        <h2>–ö—É–ø–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>
                        <div id="purchasedProducts" class="purchased-products">
                            <p class="empty-message">–í—ã –µ—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ –∫—É–ø–∏–ª–∏</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Cart Modal -->
    <!-- –£–î–ê–õ–ï–ù–ê: –∫–æ—Ä–∑–∏–Ω–∞ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è -->

    <footer>
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2025 ManualShop. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                <div class="footer-links">
                    <a href="terms.html" target="_blank" rel="noopener noreferrer">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</a>
                    <span class="footer-separator">|</span>
                    <a href="policy.html" target="_blank" rel="noopener noreferrer">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª—è
        document.addEventListener('DOMContentLoaded', () => {
            const currentUser = getCurrentUser();
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }

            displayProfileInfo();
        });

        function displayProfileInfo() {
            const currentUser = getCurrentUser();
            const accounts = JSON.parse(localStorage.getItem('accounts') || '{}');
            const userAccount = accounts[currentUser];

            if (!userAccount) return;

            document.getElementById('userEmail').textContent = currentUser;
            
            const createdDate = new Date(userAccount.createdAt);
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            document.getElementById('registrationDate').textContent = createdDate.toLocaleDateString('ru-RU', dateOptions);
            
            // –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫
            const purchases = (userAccount.purchases || []);
            document.getElementById('purchaseCount').textContent = purchases.length;

            if (purchases && purchases.length > 0) {
                const historyHtml = purchases.map(purchase => `
                    <div class="purchase-item">
                        <div class="purchase-date">${new Date(purchase.date).toLocaleDateString('ru-RU')}</div>
                        <div class="purchase-details">
                            <p>${purchase.items}</p>
                            <strong>–°—É–º–º–∞: ${purchase.total} ‚ÇΩ</strong>
                        </div>
                    </div>
                `).join('');
                document.getElementById('purchaseHistory').innerHTML = historyHtml;
            }

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
            displayPurchasedProducts(userAccount.purchasedItems || []);
        }

        function displayPurchasedProducts(purchasedItems) {
            const container = document.getElementById('purchasedProducts');
            
            if (!purchasedItems || purchasedItems.length === 0) {
                container.innerHTML = '<p class="empty-message">–í—ã –µ—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ –∫—É–ø–∏–ª–∏</p>';
                return;
            }

            const productsHtml = purchasedItems.map(item => `
                <div class="purchased-item">
                    <div class="purchased-header">
                        <span class="purchased-emoji">${item.emoji}</span>
                        <div class="purchased-info">
                            <h4>${item.title}</h4>
                            <p class="purchased-category">${item.category}</p>
                            <p class="purchased-date">–ö—É–ø–ª–µ–Ω–æ: ${new Date(item.purchaseDate).toLocaleDateString('ru-RU')}</p>
                        </div>
                    </div>
                    <div class="purchased-content">
                        <p class="purchased-description">${item.description}</p>
                        <button class="btn btn-primary" onclick="accessPurchasedItem(${item.id})">–û—Ç–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = productsHtml;
        }

        function accessPurchasedItem(productId) {
            alert('–ó–∞–≥–æ—Ç–æ–≤–∫–∞: –¥–æ—Å—Ç—É–ø –∫ –∫—É–ø–ª–µ–Ω–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É #' + productId);
        }
    </script>
</body>
</html>
